<!DOCTYPE html>
<html>
<head>
    <title>Graph Visualization</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #f0f0f0; }
        #map { height: 100vh; }
        .leaflet-container { background: #333; } /* Dark background for the map */
        .controls { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            z-index: 1000; 
            background: rgba(255, 255, 255, 0.8); 
            padding: 10px; 
            border-radius: 8px;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .controls button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        .controls button:last-child { margin-bottom: 0; }
        .controls button:hover { transform: scale(1.05); }

        /* Color definitions for buttons */
        .btn-original { background-color: #4a90e2; color: white; }
        .btn-upwards { background-color: #f5a623; color: white; }
        .btn-downwards { background-color: #d0021b; color: white; }
        
        .info-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="controls">
    <button class="btn-original" onclick="drawGraph('original.json', 'Original', '#4a90e2')">Original</button>
    <button class="btn-upwards" onclick="drawGraph('upwards.json', 'Upwards', '#f5a623')">Upwards</button>
    <button class="btn-downwards" onclick="drawGraph('downwards.json', 'Downwards', '#d0021b')">Downwards</button>
</div>

<div id="legend" class="info-legend"></div>

<script>
    const map = L.map('map').setView([47.66, 9.17], 13);
    let currentLayer = L.layerGroup().addTo(map);

    // Using a "dark mode" tile layer makes the data pop
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20
    }).addTo(map);

    const legend = document.getElementById('legend');

    async function drawGraph(jsonFile, name, color) {
        currentLayer.clearLayers();
        legend.innerHTML = `Displaying: <span style="color:${color}">${name}</span>`;
        
        const response = await fetch(jsonFile);
        const data = await response.json();

        const nodes = new Map();
        
        // --- 1. Draw Nodes First ---
        // We draw nodes as small circles so they are visible.
        data.nodes.forEach(n => {
            const latLng = L.latLng(n.lat, n.lon);
            nodes.set(n.id, latLng);
            L.circleMarker(latLng, {
                radius: 2,
                color: '#ffffff', // White outline
                weight: 0.5,
                fillColor: color,
                fillOpacity: 0.8
            }).addTo(currentLayer);
        });
        
        // --- 2. Draw Edges ---
        data.edges.forEach(edge => {
            const start = nodes.get(edge.from);
            const end = nodes.get(edge.to);

            if (start && end) {
                const polylineOptions = {
                    color: color,
                    weight: 2,      // Thicker lines
                    opacity: 0.6,   // Slightly transparent
                };

                if (edge.isShortcut) {
                    polylineOptions.dashArray = '6, 6'; // More visible dashes
                    polylineOptions.weight = 1.5;
                    polylineOptions.opacity = 0.9;
                }

                const polyline = L.polyline([start, end], polylineOptions).addTo(currentLayer);
                
                // --- 3. Add Interactive Highlighting ---
                polyline.on('mouseover', function (e) {
                    this.setStyle({
                        weight: 5,
                        opacity: 1
                    });
                });
                polyline.on('mouseout', function (e) {
                    this.setStyle(polylineOptions); // Revert to original style
                });
            }
        });
    }

    // Load the original graph by default
    drawGraph('original.json', 'Original', '#4a90e2');
</script>

</body>
</html>
